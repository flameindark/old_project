<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>setTimeout应用</title>
	<style>
		*{margin: 0;padding: 0;}
		ul{background: url(nav_bg.png) repeat-x;list-style: none;padding: 0;width: 910px;margin: 0 auto;position: relative;margin}
		ul:after{content: ".";height: 0;clear:both;zoom:1;visibility: hidden;display: block;}
		li{float: left;width:110px;background: url(nav_bg.png) no-repeat 0 -108px;height: 36px ;line-height: 36px;text-align: center;font-size: 14px;}
		a{color: #fff;text-decoration: none;margin:0 4px;display: inline-block;width: 102px;}
		a:hover{background: url(nav_bg.png) -3px -144px;font-weight: bold;}
		.first{background: url(nav_bg.png) no-repeat 0 -36px;}
		.last{background: url(nav_bg.png) no-repeat -78px -72px;width: 30px;}
		.subnav{width: auto !important;height: 27px; background: url(nav_bg.png) 0 -207px;position: absolute;
			top:41px;display: none;}
		.subnav .arrow{background:url(nav_bg.png) 0 -261px no-repeat;position: absolute;top:-4px;height: 5px;width: 11px;}
		.subnav p{background: url(nav_bg.png) 0 -180px no-repeat;margin:0px;height: 27px;line-height: 27px}
		.subnav p span{background:url(nav_bg.png) right -234px no-repeat;margin: 0;color:#33aaee;margin-left: 10px;display: inline-block;height: 27px;}
		.subnav p span a{width:70px;display: inline-block; color:#44eeff;margin: 0;height: 27px;line-height: 27px;font-size: 12px;}
		.subnav p span a:hover{text-decoration: underline;background: none;font-weight: normal;}
	</style>
</head>	
<body>
	<ul id="main">
		<li class="first"><a href="javascript:void(0)">站长之家</a></li>
		<li><a href="javascript:void(0)">行业资讯</a>
			<!-- 下面这些subnav都是借鉴Ferris的例子中的，我写的实现太麻烦 -->
			<div class="subnav">
                <em class="arrow"></em>
                <p>        	
                    <span>
                        <a href="javascript:;">业界动态</a>|
                        <a href="javascript:;">收购融资</a>|
                        <a href="javascript:;">门户动态</a>|
                        <a href="javascript:;">搜索引擎</a>|
                        <a href="javascript:;">网络游戏</a>|
                        <a href="javascript:;">电子商务</a>|
                        <a href="javascript:;">广告传媒</a>|
                        <a href="javascript:;">厂商开发</a>
                    </span>
                </p>
            </div>

		</li>
		<li><a href="javascript:void(0)">站长在线</a>
			<div class="subnav">
                <em class="arrow"></em>
                <p>        	
                    <span>
                        <a href="javascript:;">站长报道</a>|
                        <a href="javascript:;">好站推荐</a>|
                        <a href="javascript:;">站长聚会</a>|
                        <a href="javascript:;">站长访谈</a>|
                        <a href="javascript:;">站长茶馆</a>|
                        <a href="javascript:;">网站排行</a>
                    </span>
                </p>
            </div>

		</li>
		<li><a href="javascript:void(0)">网站运营</a>
			 <div class="subnav">
                <em class="arrow"></em>
                <p>        	
                    <span>
                        <a href="javascript:;">建站经验</a>|
                        <a href="javascript:;">策划盈利</a>|
                        <a href="javascript:;">搜索优化</a>|
                        <a href="javascript:;">网站推广</a>|
                        <a href="javascript:;">免费资源</a>
                    </span>
                </p>
            </div>

		</li>
		<li><a href="javascript:void(0)">设计在线</a>
			<div class="subnav">
                <em class="arrow"></em>
                <p>        	
                    <span>
                        <a href="javascript:;">酷站推荐</a>|
                        <a href="javascript:;">网页设计</a>|
                        <a href="javascript:;">WEB标准</a>|
                        <a href="javascript:;">视频处理</a>|
                        <a href="javascript:;">设计活动</a>
                    </span>
                </p>
            </div>

		</li>
		<li><a href="javascript:void(0)">网络编程</a>
			 <div class="subnav">
                <em class="arrow"></em>
                <p>        	
                    <span>
                        <a href="javascript:;">Asp编程</a>|
                        <a href="javascript:;">Php编程</a>|
                        <a href="javascript:;">.Net编程</a>|
                        <a href="javascript:;">Xml编程</a>|
                        <a href="javascript:;">Access</a>|
                        <a href="javascript:;">Mssql</a>|
                        <a href="javascript:;">Mysql</a>
                    </span>
                </p>
            </div>

		</li>
		<li><a href="javascript:void(0)">联盟资讯</a>
			 <div class="subnav">
                <em class="arrow"></em>
                <p>        	
                    <span>
                        <a href="javascript:;">联盟动态</a>|
                        <a href="javascript:;">联盟介绍</a>|
                        <a href="javascript:;">联盟点评</a>|
                        <a href="javascript:;">网赚技巧</a>
                    </span>
                </p>
            </div>

		</li>
		<li><a href="javascript:void(0)">服务器</a>
			<div class="subnav">
                <em class="arrow"></em>
                <p>        	
                    <span>
                        <a href="javascript:;">Web服务器</a>|
                        <a href="javascript:;">Ftp服务器</a>|
                        <a href="javascript:;">Mail服务器</a>|
                        <a href="javascript:;">Dns服务器</a>|
                        <a href="javascript:;">Win服务器</a>|
                        <a href="javascript:;">Linux服务器</a>|
                        <a href="javascript:;">安全防护</a>|
                        <a href="javascript:;">虚拟主机</a>
                    </span>
                </p>
            </div>
		</li>
		<li class="last"><a href="javascript:void(0)"></a></li>
	</ul>
	<script>
		//借用ferris的get对象的方法
		// 定义get对象，对各种不同的获取dom的方法进行分类实现。。。
		// var get = {
		// 	byId: function(id) {
		// 		return document.getElementById(id)
		// 	},
		// 	byClass: function(sClass, oParent) {
		// 		var aClass = [];
		// 		var reClass = new RegExp("(^| )" + sClass + "( |$)");
		// 		var aElem = this.byTagName("*", oParent);
		// 		for (var i = 0; i < aElem.length; i++) reClass.test(aElem[i].className) && aClass.push(aElem[i]);
		// 		return aClass
		// 	},
		// 	byTagName: function(elem, obj) {
		// 		return (obj||document).getElementsByTagName(elem)
		// 	}
		// };

		var oMain=document.getElementById("main"),
			oLi=oMain.getElementsByTagName('li'),
			aSubNav=oMain.getElementsByClassName('subnav'),
			oSubnav=timer=oEm=null;//这里的几个节点都要在循环中，通过this来调用最方便。
			// oSubnav=document.getElementsByClassName('subnav'),//这里通过从总体中选出没有在当前父节点下
			// 通过this选出该节点好，因为这个下标不统一

			for (var i = 1; i < oLi.length; i++) {
				oLi[i].index=i;
				oLi[i].onmouseover=function  () {
					//先隐藏所有的subnav
					for (i = 0; i < aSubNav.length; i++)aSubNav[i].style.display = "none";
					//在左边的菜单下的subnav的显示和右边有不同。。。通过if判断。这个是通过
					// 自己的臆测，通过判断前4个在左对齐来写的并不具有普遍性（我自己之前的代码）
					// if (this.index<5){ 
					// 	oSubnav[this.index-1].style.left=116+108*(this.index-1)+"px";
					// 	oArrow[this.index-1].style.left=50+"px";
					// }else{
					// 	oSubnav[this.index-1].style.right=0+"px";
					// 	oArrow[this.index-1].style.right=80+100*(oLi.length-this.index-2)+"px";
					// }

					//下面是改进方法
					//首先要将当前的subnav和em节点选出来
					oSubnav=this.getElementsByClassName('subnav')[0];
					oEm=this.getElementsByClassName('arrow')[0];
					//显示subnav	
					oSubnav.style.display="block";
					//通过观察发现规律，什么时候左对齐，什么时候右对齐。
					oMain.offsetWidth-this.offsetLeft>oSubnav.offsetWidth?
					oSubnav.style.left=this.offsetLeft+"px":
					oSubnav.style.right=0+"px";
					//下面确定箭头的位置在什么位置，找出规律
					oEm.style.left = this.offsetLeft - oSubnav.offsetLeft + 50 + "px";
					clearTimeout(timer);
					
					// 同时如果subnav也被鼠标移入，阻止冒泡。此时清除onmouseout中的定时器使subnav显示，不消失
					oSubnav.onmouseover = function (event){
						(event || window.event).cancelBubble = true;
						clearTimeout(timer)
						}
				}

				oLi[i].onmouseout=function  () {
					timer=setTimeout(function  () {
						oSubnav.style.display="none";
					},400)	
				}
			};

			//参考的脚本。
			// 定义get对象，对各种不同的获取dom的方法进行分类实现。。。
		// var get = {
		// 	byId: function(id) {
		// 		return document.getElementById(id)
		// 	},
		// 	byClass: function(sClass, oParent) {
		// 		var aClass = [];
		// 		var reClass = new RegExp("(^| )" + sClass + "( |$)");
		// 		var aElem = this.byTagName("*", oParent);
		// 		for (var i = 0; i < aElem.length; i++) reClass.test(aElem[i].className) && aClass.push(aElem[i]);
		// 		return aClass
		// 	},
		// 	byTagName: function(elem, obj) {
		// 		return (obj || document).getElementsByTagName(elem)
		// 	}
		// };
		// window.onload = function ()
		// {
		// 	var oNav = get.byId("nav");
		// 	var aLi = get.byTagName("li", oNav);
		// 	var aSubNav = get.byClass("subnav", oNav);
		// 	var oSubNav = oEm = timer = null;
		// 	var i = 0;
			
		// 	for (i = 1; i < aLi.length; i++)
		// 	{
		// 		aLi[i].onmouseover = function ()
		// 		{
		// 			//隐藏所有子菜单
		// 			for (i = 0; i < aSubNav.length; i++)aSubNav[i].style.display = "none";
					
		// 			//获取该项下的子菜单
		// 			oSubNav = get.byClass("subnav", this)[0];
					
		// 			//获取该项下的指示箭头
		// 			oEm = get.byTagName("em", this)[0];
					
		// 			//显示该项下的子菜单
		// 			oSubNav.style.display = "block";
					
		// 			//判断显示区域
		// 			oNav.offsetWidth - this.offsetLeft > oSubNav.offsetWidth ? 
					
		// 			//如果在显示范围居左显示
		// 			oSubNav.style.left = this.offsetLeft + "px" :
					
		// 			//超出显示范围居右显示
		// 			oSubNav.style.right = 0;
					
		// 			//计算指标箭头显示位置
		// 			oEm.style.left = this.offsetLeft - oSubNav.offsetLeft + 50 + "px";
		// 			clearTimeout(timer);
					
		// 			//阻止事件冒泡
		// 			oSubNav.onmouseover = function (event)
		// 			{
		// 				(event || window.event).cancelBubble = true;
		// 				clearTimeout(timer)
		// 			}
		// 		};
				
		// 		aLi[i].onmouseout = function ()
		// 		{
		// 			timer = setTimeout(function () {
		// 				oSubNav.style.display = "none"
		// 			},300)	
		// 		}
		// 	}
		// };

	</script>
</body>
</html>